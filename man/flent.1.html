<!-- Creator     : groff version 1.22.3 -->
<!-- CreationDate: Mon May 25 12:11:52 2015 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>FLENT</title>

</head>
<body>

<h1 align="center">FLENT</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#INVOCATION">INVOCATION</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#REQUIREMENTS">REQUIREMENTS</a><br>
<a href="#OPTIONS">OPTIONS</a><br>
<a href="#SUPPLIED TESTS">SUPPLIED TESTS</a><br>
<a href="#OUTPUT FORMATS">OUTPUT FORMATS</a><br>
<a href="#THE FLENT GUI">THE FLENT GUI</a><br>
<a href="#RC FILE">RC FILE</a><br>
<a href="#BATCH FILES">BATCH FILES</a><br>
<a href="#RUNNING TESTS WITH THE D-ITG TOOL">RUNNING TESTS WITH THE D-ITG TOOL</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#THE JSON DATA FORMAT">THE JSON DATA FORMAT</a><br>
<a href="#SIGNALS">SIGNALS</a><br>
<a href="#BUGS">BUGS</a><br>
<a href="#AUTHORS">AUTHORS</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Flent &minus;
the FLExible Network Tester. Manual page for Flent
v0.11.0-git</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>flent</b>
[<i>options</i>] <i>&lt;host|test|input file</i>
...<i>&gt;</i></p>

<h2>INVOCATION
<a name="INVOCATION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">When run, flent
must be supplied either (a) a test name and one or more host
names to connect to, or (b) one or more input files
containing data from previous runs to post-process.</p>

<p style="margin-left:11%; margin-top: 1em">Test names,
hostnames and input file names can all be specified as
unqualified arguments, and flent will do its best to guess
which is which. For each argument, if it is an existing
file, it is assumed to be an input file, if it is the name
of an existing test configuration it&rsquo;s assumed to be a
test name, and if neither of those are true, it is assumed
to be a host name. The <b>-i</b> and <b>-H</b> switches can
be used to explicitly specify the interpretation of an
argument.</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Flent is a
wrapper around <i>netperf</i> and similar tools to run
predefined tests and aggregate and plot the results. It
defines several tests that can be run against one or more
hosts, primarily targeted at testing for the presence of
bufferbloat under various conditions.</p>

<p style="margin-left:11%; margin-top: 1em">The aggregated
data is saved in (gzipped) JSON format for later processing
and/or import into other tools. The JSON format is
documented below.</p>

<p style="margin-left:11%; margin-top: 1em">Apart from the
JSON format, the data can be output as csv values, emacs org
mode tables or plots. Each test can specify several
different plots, including time-series plots of the values
against each other, as well as CDF plots of (e.g.) ping
times.</p>

<p style="margin-left:11%; margin-top: 1em">Plots can be
output to the formats supported by matplotlib by specifying
the output filename with <b>-o</b>
<i>output.{png,ps,pdf,svg}</i>. If no output file is
specified, the plot is diplayed using matplotlib&rsquo;s
interactive plot browser, which also allows saving of the
output (in .png format).</p>

<h2>REQUIREMENTS
<a name="REQUIREMENTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Flent runs on
Python, versions 2.7+ and 3.3+. Plotting requires a
functional matplotlib installation (but everything else can
run without matplotlib). For the interactive plot viewer, a
graphical display (and suitably configured matplotlib) is
required.</p>

<p style="margin-left:11%; margin-top: 1em">Most tests
employ the <i>netperf</i> benchmarking tool to run the
tests. Version 2.6 or higher is required, and netperf must
be compiled with the <b>&minus;&minus;enable&minus;demo</b>
option passed to ./configure. Some tests use <i>iperf</i> in
addition to, or instead of netperf. Both tools must be
available in the <i>PATH</i>.</p>

<p style="margin-left:11%; margin-top: 1em">For ICMP ping
measurements, the version of <i>ping</i> employed must
support output timestamping (the <b>&minus;D</b> parameter
to GNU ping). This is <b>not</b> supported by the BSD and
OSX versions of ping. As an alternative to the regular ping
command, the <i>fping</i> utility (see <i>fping.org</i>) can
be employed. In that case fping must be version 3.5 or
greater. Flent will attempt to detect the presence of fping
in the <i>PATH</i> and check for support for the
<b>&minus;D</b> parameter. If this check is successful,
fping will be employed for ping data, otherwise the system
ping will be used.</p>

<h2>OPTIONS
<a name="OPTIONS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>&minus;o</b>
OUTPUT, <b>&minus;&minus;output</b>=<i>OUTPUT</i></p>

<p style="margin-left:22%;">File to write processed output
to (default standard out).</p>

<p style="margin-left:11%;"><b>&minus;D</b> DATA_DIR,
<b>&minus;&minus;data&minus;dir</b>=<i>DATA_DIR</i></p>

<p style="margin-left:22%;">Directory to store data files
in. Defaults to the system tmpdir.</p>

<p style="margin-left:11%;"><b>&minus;i</b> INPUT,
<b>&minus;&minus;input</b>=<i>INPUT</i></p>

<p style="margin-left:22%;">File to read input from
(instead of running tests). Input files can also be
specified as unqualified arguments without using the
<b>&minus;i</b> switch.</p>

<p style="margin-left:11%;"><b>&minus;f</b> FORMAT,
<b>&minus;&minus;format</b>=<i>FORMAT</i></p>

<p style="margin-left:22%;">Select output format (plot,
csv, org_table, stats). Default is no processed output (just
writes the JSON data file).</p>

<p style="margin-left:11%;"><b>&minus;p</b> PLOT,
<b>&minus;&minus;plot</b>=<i>PLOT</i></p>

<p style="margin-left:22%;">Select which plot to output for
the given test (implies <b>&minus;f</b> plot). Use the
<b>&minus;&minus;list&minus;plots</b> option to see
available plots.</p>

<p style="margin-left:11%;"><b>&minus;t</b> TITLE,
<b>&minus;&minus;title&minus;extra</b>=<i>TITLE</i></p>

<p style="margin-left:22%;">Text to add to plot title and
data file name.</p>

<p style="margin-left:11%;"><b>&minus;n</b> NOTE,
<b>&minus;&minus;note</b>=<i>NOTE</i></p>

<p style="margin-left:22%;">Add arbitrary text as a note to
be stored in the JSON data file (under the <i>NOTE</i> key
in the metadata object).</p>

<p style="margin-left:11%;"><b>&minus;r</b> RCFILE,
<b>&minus;&minus;rcfile</b>=<i>RCFILE</i></p>

<p style="margin-left:22%;">Load configuration data from
<i>RCFILE</i> (default <i>~/.flentrc</i>). See section below
for information on the rc file format.</p>

<p style="margin-left:11%;"><b>&minus;x</b>,
<b>&minus;&minus;extended&minus;metadata</b></p>

<p style="margin-left:22%;">Collect extended metadata and
store it with the data file. May include details of your
machine you don&rsquo;t want to distribute; see the section
on the data format below.</p>


<p style="margin-left:11%;"><b>&minus;&minus;remote&minus;metadata</b>=<i>HOSTNAME</i></p>

<p style="margin-left:22%;">Collect extended metadata from
a remote host. <i>HOSTNAME</i> is passed verbatim to ssh, so
can include hosts specified in ~/.ssh/config. Note that
gathering the data can take some time, since it involves
executing several remote commands. This option can be
specified multiple times and implies
<b>--extended-metadata</b>.</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="7%">


<p><b>--gui</b></p></td>
<td width="4%"></td>
<td width="78%">


<p>Run the flent GUI. All other options are used as
defaults in the GUI, but can be changed once it is running.
See section below for a description of the GUI.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>--new-gui-instance</b></p>

<p style="margin-left:22%;">Start a new GUI instance.
Otherwise, flent will try to connect to an already running
GUI instance and have that load any new data files specified
as arguments. Implies <b>--gui</b> when passed on the
command line, but not when set in the rc file. Note that
when multiple GUI instances are running, there is no
guarantee as to which instance will get a subsequent open
request (if run again without
<b>--new-gui-instance</b>).</p>

<p style="margin-left:11%;"><b>--gui-no-defer</b></p>

<p style="margin-left:22%;">Normally, the GUI defers
redrawing plots until they are needed to avoid redrawing all
open plots every time an option changes. This switch turns
off that optimisation in favour of always redrawing
everything straight away. This is useful when loading a
bunch of plots from the command line and then wanting to
flip through them without drawing delay.</p>

<p style="margin-left:11%;"><b>&minus;b</b> BATCH_NAME,
<b>&minus;&minus;batch&minus;name</b>=<i>BATCH_NAME</i></p>

<p style="margin-left:22%;">Run test batch BATCH_NAME (must
be specified in a batch file loaded by the
<b>--batch-file</b> option). Can be supplied multiple
times.</p>

<p style="margin-left:11%;"><b>&minus;B</b> BATCH_FILE,
<b>&minus;&minus;batch&minus;file</b>=<i>BATCH_FILE</i></p>

<p style="margin-left:22%;">Load batch file BATCH_FILE. Can
be specified multiple times, in which case the files will be
combined (with identically-named sections being overridden
by later files). See appropriate section below for an
explanation of the batch file format.</p>


<p style="margin-left:11%;"><b>&minus;&minus;batch&minus;override</b>=<i>key=value</i></p>

<p style="margin-left:22%;">Override parameter
&rsquo;key&rsquo; in the batch config and set it to
&rsquo;value&rsquo;. The key name will be case folded to
lower case. Can be specified multiple times.</p>

<p style="margin-left:11%;"><b>--batch-dry-run</b></p>

<p style="margin-left:22%;">Dry batch run. Prints what
would be done, but doesn&rsquo;t actually run any tests.</p>


<p style="margin-left:11%;"><b>&minus;&minus;batch&minus;repetitions</b>=<i>REPETITIONS</i></p>

<p style="margin-left:22%;">Shorthand for
<b>--batch-override</b>
<i>&rsquo;repetitions=REPETITIONS&rsquo;</i>.</p>

<p style="margin-left:11%;"><b>Test configuration:</b></p>

<p style="margin-left:11%; margin-top: 1em">These options
affect the behaviour of the test being run and have no
effect when parsing input files. <b><br>
&minus;H</b> HOST, <b>&minus;&minus;host</b>=<i>HOST</i></p>

<p style="margin-left:22%;">Host to connect to for tests.
For tests that support it, multiple hosts can be specified
by supplying this option multiple times. Hosts can also be
specified as unqualified arguments; this parameter
guarantees that the argument be interpreted as a host name
(rather than being subject to auto&minus;detection between
input files, hostnames and test names).</p>


<p style="margin-left:11%;"><b>&minus;&minus;local-bind</b>=<i>IP</i></p>

<p style="margin-left:22%;">Local hostname or IP address to
bind to (for test tools that support this).</p>

<p style="margin-left:11%;"><b>&minus;l</b> LENGTH,
<b>&minus;&minus;length</b>=<i>LENGTH</i></p>

<p style="margin-left:22%;">Base test length (some tests
may add some time to this).</p>

<p style="margin-left:11%;"><b>&minus;s</b> STEP_SIZE,
<b>&minus;&minus;step&minus;size</b>=<i>STEP_SIZE</i></p>

<p style="margin-left:22%;">Measurement data point step
size.</p>

<p style="margin-left:11%;"><b>&minus;d</b> DELAY,
<b>&minus;&minus;delay</b>=<i>DELAY</i></p>

<p style="margin-left:22%;">Number of seconds to delay
parts of test (such as bandwidth loaders).</p>

<p style="margin-left:11%;"><b>&minus;4</b>,
<b>&minus;&minus;ipv4</b></p>

<p style="margin-left:22%;">Use IPv4 for tests (some tests
may ignore this).</p>

<p style="margin-left:11%;"><b>&minus;6</b>,
<b>&minus;&minus;ipv6</b></p>

<p style="margin-left:22%;">Use IPv6 for tests (some tests
may ignore this).</p>


<p style="margin-left:11%;"><b>&minus;&minus;socket&minus;timeout</b>=<i>SOCKET_TIMEOUT</i></p>

<p style="margin-left:22%;">Socket timeout (in seconds)
used for UDP delay measurement, to prevent stalls on packet
loss. Only enabled if the installed netperf version is
detected to support this (requires SVN version of
netperf).</p>

<p style="margin-left:22%; margin-top: 1em">For the default
value, see the output of flent -h. The value of this
parameter is an implicit upper bound on how long a
round-trip time that can be measured. As such you may need
to adjust it if you are experiencing latency above the
default value. Set to 0 to disable.</p>


<p style="margin-left:11%;"><b>&minus;&minus;test&minus;parameter</b>=<i>key=value</i></p>

<p style="margin-left:22%;">Arbitrary test parameter in
key=value format. Key will be case folded to lower case.
Some test configurations may alter behaviour based on values
passed as test parameters. Additionally, the values are
stored with the results metadata, and so can be used for
arbitrary resultset categorisation. Can be specified
multiple times.</p>


<p style="margin-left:11%;"><b>&minus;&minus;swap&minus;up&minus;down</b></p>

<p style="margin-left:22%;">Switch upstream and downstream
directions for data transfer. This means that
&rsquo;upload&rsquo; will become &rsquo;download&rsquo; and
vice versa. Works by exchanging netperf TCP_MAERTS and
TCP_STREAM parameters, so only works for tests that employ
these as their data transfer, and only for the TCP
streams.</p>

<p style="margin-left:11%;"><b>Plot configuration:</b></p>

<p style="margin-left:11%; margin-top: 1em">These options
are used to configure the appearance of plot output and only
make sense combined with <b>&minus;f</b> <i>plot</i>.
<b><br>
&minus;z</b>, <b>&minus;&minus;zero&minus;y</b></p>

<p style="margin-left:22%;">Always start y axis of plot at
zero, instead of autoscaling the axis (also disables log
scales). Autoscaling is still enabled for the upper
bound.</p>

<p style="margin-left:11%;"><b>&minus;I</b>,
<b>&minus;&minus;invert&minus;latency&minus;y</b></p>

<p style="margin-left:22%;">Invert the y-axis for latency
data series (making plots show &rsquo;better values
upwards&rsquo;).</p>


<p style="margin-left:11%;"><b>&minus;&minus;disable&minus;log</b></p>

<p style="margin-left:22%;">Disable log scales on
plots.</p>


<p style="margin-left:11%;"><b>&minus;&minus;norm&minus;factor</b>=<i>FACTOR</i></p>

<p style="margin-left:22%;">Factor to normalise data by.
I.e. divide all data points by this value. Can be specified
multiple times, in which case each value corresponds to a
data series.</p>


<p style="margin-left:11%;"><b>&minus;&minus;scale&minus;data</b>=<i>SCALE_DATA</i></p>

<p style="margin-left:22%;">Additional data files to
consider when scaling the plot axes (for plotting several
plots with identical axes). Note, this displays only the
first data set, but with axis scaling taking into account
the additional data sets. Can be supplied multiple times;
see also <b>&minus;&minus;scale&minus;mode</b>.</p>

<p style="margin-left:11%;"><b>&minus;S</b>,
<b>&minus;&minus;scale&minus;mode</b></p>

<p style="margin-left:22%;">Treat file names (except for
the first one) passed as unqualified arguments as if passed
as <b>&minus;&minus;scale&minus;data</b> (default as if
passed as <b>&minus;&minus;input</b>).</p>


<p style="margin-left:11%;"><b>&minus;&minus;concatenate</b></p>

<p style="margin-left:22%;">Concatenate multiple result
sets into one data series. This means that each data file
will have its time axis shifted by the preceding series
duration and appended to the first data set specified. Only
works for data sets from the same test, obviously.</p>


<p style="margin-left:11%;"><b>&minus;&minus;absolute&minus;time</b></p>

<p style="margin-left:22%;">Plot data points with absolute
UNIX time on the x-axis. This requires the absolute starting
time for the test run to be stored in the data file, and so
it won&rsquo;t work with data files that predates this
feature.</p>


<p style="margin-left:11%;"><b>&minus;&minus;subplot&minus;combine</b></p>

<p style="margin-left:22%;">When plotting multiple data
series, plot each one on a separate subplot instead of
combining them into one plot. This mode is not supported for
all plot types, and only works when <b>--scale-mode</b> is
disabled.</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;print&minus;n</b></p>

<p style="margin-left:22%;">Do not print the number of data
points on combined plots. When using plot types that
combines results from several test runs, the number of data
series in each combined data point is normally added after
the series name, (n=X) for X data series. This option turns
that off.</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;annotation</b></p>

<p style="margin-left:22%;">Exclude annotation with
hostnames, time and test length from plots.</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;title</b></p>

<p style="margin-left:22%;">Exclude title from plots.</p>


<p style="margin-left:11%;"><b>&minus;&minus;override&minus;title</b>=<i>TITLE</i></p>

<p style="margin-left:22%;">Override plot title with this
string. Completely discards the configured title (from the
test configuration), as well as the title stored in the data
set, and replaces it with the value supplied here. This is
useful to override the plot title <i>at the time of
plotting</i>, for instance to add a title to an aggregate
plot from several data series. When this parameter is
specified, <b>--no-title</b> has no effect.</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;markers</b></p>

<p style="margin-left:22%;">Don&rsquo;t use line markers to
differentiate data series on plots.</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;legend</b></p>

<p style="margin-left:22%;">Exclude legend from plots.</p>


<p style="margin-left:11%;"><b>&minus;&minus;filter&minus;legend</b></p>

<p style="margin-left:22%;">Filter legend labels by
removing the longest common substring from all entries. This
is not particularly smart, so should be used with care.</p>


<p style="margin-left:11%;"><b>&minus;&minus;filter&minus;regexp</b>=<i>REGEXP</i></p>

<p style="margin-left:22%;">Filter the plot legend by the
supplied regular expression. Note that for combining several
plot results, the regular expression is also applied before
the grouping logic, meaning that a too wide filter can mess
up the grouping.</p>


<p style="margin-left:11%;"><b>&minus;&minus;figure&minus;width</b>=<i>FIG_WIDTH</i></p>

<p style="margin-left:22%;">Figure width in inches. Used
when saving plots to file and for default size of the
interactive plot window.</p>


<p style="margin-left:11%;"><b>&minus;&minus;figure&minus;height</b>=<i>FIG_HEIGHT</i></p>

<p style="margin-left:22%;">Figure height in inches. Used
when saving plots to file and for default size of the
interactive plot window.</p>


<p style="margin-left:11%;"><b>&minus;&minus;figure&minus;dpi</b>=<i>FIG_DPI</i></p>

<p style="margin-left:22%;">Figure DPI. Used when saving
plots to raster format files.</p>


<p style="margin-left:11%;"><b>&minus;&minus;no&minus;matplotlibrc</b></p>

<p style="margin-left:22%;">Don&rsquo;t load included
matplotlibrc values. Use this if autodetection of custom
matplotlibrc fails and flent is inadvertently overriding rc
values.</p>

<p style="margin-left:11%;"><b>Test tool-related options:
<br>
&minus;&minus;control&minus;host</b>=<i>HOST</i></p>

<p style="margin-left:22%;">Hostname for the test control
connection (for test tools that support this). Default:
First hostname of test target.</p>

<p style="margin-left:22%; margin-top: 1em">When running
tests that uses D-ITG as a test tool (such as the voip-*
tests), this switch controls where flent will look for the
D-ITG control server (see section below on running tests
with D-ITG). For Netperf-based tests, this option is passed
to Netperf to control where to point the control connection.
This is useful to, for instance, to run the control server
communication over a separate control network so as to not
interfere with test traffic.</p>


<p style="margin-left:11%;"><b>&minus;&minus;control&minus;local-bind</b>=<i>IP</i></p>

<p style="margin-left:22%;">Local hostname or IP to bind
control connection to (for test tools that support it;
currently netperf). If not supplied, the value for
--local-bind will be used. Note that if this value is passed
but <b>--local-bind</b> is <b>not</b>, netperf will use the
value specified here to bind the data connections to as
well.</p>


<p style="margin-left:11%;"><b>&minus;&minus;netperf&minus;control&minus;port</b>=<i>PORT</i></p>

<p style="margin-left:22%;">Port for Netperf control
server. Default: 12865.</p>


<p style="margin-left:11%;"><b>&minus;&minus;ditg&minus;control&minus;port</b>=<i>PORT</i></p>

<p style="margin-left:22%;">Port for D-ITG control server.
Default: 8000.</p>


<p style="margin-left:11%;"><b>&minus;&minus;ditg&minus;control&minus;secret</b>=<i>SECRET</i></p>

<p style="margin-left:22%;">Secret for D-ITG control server
authentication. Default: &rsquo;&rsquo;.</p>


<p style="margin-left:11%;"><b>&minus;&minus;http&minus;getter&minus;urllist</b>=<i>FILENAME</i></p>

<p style="margin-left:22%;">When running HTTP tests, the
http-getter tool is used to fetch URLs (see
https://github.com/tohojo/http-getter). This option
specifies the filename containing the list of HTTP URLs to
get. Can also be a URL, which will then be downloaded as
part of each test iteration. If not specified, this is set
to http://&lt;hostname&gt;/filelist.txt where
&lt;hostname&gt; is the first test hostname.</p>


<p style="margin-left:11%;"><b>&minus;&minus;http&minus;getter&minus;dns&minus;servers</b>=<i>DNS_SERVERS</i></p>

<p style="margin-left:22%;">DNS servers to use for
http-getter lookups. Format is host[:port][,host[:port]]...
This option will only work if libcurl supports it (needs to
be built with the ares resolver). Default is none (use the
system resolver).</p>


<p style="margin-left:11%;"><b>&minus;&minus;http&minus;getter&minus;timeout</b>=<i>MILLISECONDS</i></p>

<p style="margin-left:22%;">Timeout for HTTP connections.
Default is to use the test length.</p>


<p style="margin-left:11%;"><b>&minus;&minus;http&minus;getter&minus;workers</b>=<i>NUMBER</i></p>

<p style="margin-left:22%;">Number of workers to use for
getting HTTP urls. Default is 4.</p>

<p style="margin-left:11%;"><b>Misc and debugging options:
<br>
&minus;L</b> LOG_FILE,
<b>&minus;&minus;log&minus;file</b>=<i>LOG_FILE</i></p>

<p style="margin-left:22%;">Write debug log (test program
output) to log file.</p>


<p style="margin-left:11%;"><b>&minus;&minus;list&minus;tests</b></p>

<p style="margin-left:22%;">List available tests and
exit.</p>


<p style="margin-left:11%;"><b>&minus;&minus;list&minus;plots</b></p>

<p style="margin-left:22%;">List available plots for
selected test and exit.</p>

<p style="margin-left:11%;"><b>&minus;V</b>,
<b>&minus;&minus;version</b></p>

<p style="margin-left:22%;">Show Flent version information
and exit.</p>

<p style="margin-left:11%;"><b>&minus;h</b>,
<b>&minus;&minus;help</b></p>

<p style="margin-left:22%;">Show usage help message and
exit.</p>

<h2>SUPPLIED TESTS
<a name="SUPPLIED TESTS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Test are
supplied as Python files and can specify commands to run
etc. For a full list of the tests supported by flent, see
the <b>&minus;&minus;list&minus;tests</b> option. <b><br>
The Realtime Response Under Load (RRUL) test</b></p>

<p style="margin-left:22%; margin-top: 1em">This test
exists in a couple of variants and is a partial
implementation of the RRUL specification as written by Dave
Taht (see
<i>https://github.com/dtaht/deBloat/blob/master/spec/rrule.doc?raw=true</i>).
It works by running RTT measurement using ICMP ping and UDP
roundtrip time measurement, while loading up the link with
eight TCP streams (four downloads, four uploads). This quite
reliably saturates the measured link (wherever the
bottleneck might be), and thus exposes bufferbloat when it
is present.</p>

<p style="margin-left:11%;"><b>Simple TCP flow
tests</b></p>

<p style="margin-left:22%; margin-top: 1em">These tests
combine a TCP flow (either in one direction, or both) with
an ICMP ping measurement. It&rsquo;s a simpler test than
RRUL, but in some cases the single TCP flow can be
sufficient to saturate the link.</p>

<p style="margin-left:11%;"><b>UDP flood test</b></p>

<p style="margin-left:22%; margin-top: 1em">This test runs
<i>iperf</i> configured to emit 100Mbps of UDP packets
targeted at the test host, while measuring RTT using ICMP
ping. It is useful for observing latency in the face of a
completely unresponsive packet stream.</p>

<h2>OUTPUT FORMATS
<a name="OUTPUT FORMATS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
output formats are currently supported by flent: <b><br>
Plot output</b> (<b>&minus;f</b> <i>plot</i>)</p>

<p style="margin-left:22%; margin-top: 1em">Output test
data as one of a series of graphical plots of timeseries
data or summarised as a CDF plot. Each test supplies a
number of different plots; the list of plots for a given
test is output by the <b>&minus;&minus;list&minus;plots</b>
switch (which must be supplied along with a test name).</p>

<p style="margin-left:22%; margin-top: 1em">The plots are
drawn by matplotlib, and can be displayed on the screen
interactively (requires a graphical display), or output to a
file in svg, pdf, ps and png formats. Using the
<b>&minus;o</b> switch turns out file output (the file
format is inferred from the file name), while not supplying
the switch turns on the interactive plot viewer.</p>

<p style="margin-left:11%;"><b>Tabulated output</b>
(<b>&minus;f</b> <i>csv</i> and <b>&minus;f</b>
<i>org_table</i>)</p>

<p style="margin-left:22%; margin-top: 1em">These formats
output the numeric data in a tabulated format to be consumed
by other applications. The <i>csv</i> output format is a
comma-separated output that can be imported into e.g.
spreadsheets, while <i>org_table</i> outputs a tabulated
output in the table format supported by Emacs org mode. The
data is output in text format to standard output, or written
to a file if invoked with the <b>&minus;o</b> parameter.</p>

<p style="margin-left:11%;"><b>Statistics output</b>
(<b>&minus;f</b> <i>stats</i>)</p>

<p style="margin-left:22%; margin-top: 1em">This output
format outputs various statistics about the test data, such
as total bandwidth consumed, and various statistical
measures (min/max/mean/median/std dev/variance) for each
data source specified in the relevant test (this can include
some data sources not includes on plots). The data is output
in text format to standard output, or written to a file if
invoked with the <b>&minus;o</b> parameter.</p>

<p style="margin-left:11%;"><b>Metadata output</b>
(<b>&minus;f</b> <i>metadata</i>)</p>

<p style="margin-left:22%; margin-top: 1em">This output
format outputs the test metadata as pretty-printed json
(also suitable for human consumption). It is output as a
list of objects, where each object corresponds to the
metadata of one test. Mostly useful for inspecting metadata
of stored data files.</p>

<h2>THE FLENT GUI
<a name="THE FLENT GUI"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Flent comes
equipped with a GUI to browse and plot previously captured
datasets. The GUI requires PyQt4; if this is installed, it
can be launched with the <b>--gui</b> parameter.
Additionally, if flent is launched without parameters and
without a controlling terminal, the GUI will be launched
automatically.</p>

<p style="margin-left:11%; margin-top: 1em">The GUI can be
used for interactively plotting previously captured
datasets, and makes it easy to compare results from several
test runs. It presents a tabbed interface to graphs of data
files, allows dynamic configuration of plots, and includes a
metadata browser. For each loaded data file, additional data
files can be loaded and added to the plot, similar to what
happens when specifying multiple input files for plotting on
the command line. A checkbox controls whether the added data
files are added as separate entries to the plot, or whether
they are used for scaling the output (mirroring the
<b>--scale-mode</b>) command line switch.</p>

<p style="margin-left:11%; margin-top: 1em">The GUI also
incorporates matplotlib&rsquo;s interactive browsing
toolbar, enabling panning and zooming of the plot area,
dynamic configuration of plot and axis parameters and labels
and saving the plots to file. The exact dynamic features
supported depends on the installed version of
matplotlib.</p>

<h2>RC FILE
<a name="RC FILE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Some of the
command line options can be specified in an rc file. By
default, flent looks for this in <i>~/.flentrc</i>, but an
alternative location can be specified with the
<b>--rcfile</b> command line option.</p>

<p style="margin-left:11%; margin-top: 1em">The rc file
allows options to be specified globally, an optionally
overridden for specific tests. For an explanation of the
options, refer to the annotated example rc file, by default
installed to
<i>/usr/share/doc/flent/flentrc.example</i>.</p>

<h2>BATCH FILES
<a name="BATCH FILES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Flent supports
reading batch files to automate running several tests and do
setup/teardown of test environment etc. This greatly aids
reproducibility of tests.</p>

<p style="margin-left:11%; margin-top: 1em">The batch file
format is based on the standard .ini file format, with
sections being split into three namespaces: Commands,
starting with Command::, batches, starting with Batch::, and
arguments, starting with Arg::. Briefly, a batch is the
entity that will be run, commands can be run before or after
each batch iteration, and arguments allows parameterising
batches.</p>

<p style="margin-left:11%; margin-top: 1em"><b>FIXME</b>:
Expand this section; for now, try looking at the
<i>batchfile.example</i> file supplied with the source code,
and try to work things out from there :).</p>

<h2>RUNNING TESTS WITH THE D-ITG TOOL
<a name="RUNNING TESTS WITH THE D-ITG TOOL"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This version of
flent has experimental support for running and parsing the
output of the D-ITG test tool (see
<i>http://traffic.comics.unina.it/software/ITG/</i>). Flent
supports parsing the one-way delay as measured by D-ITG.
However, in order to do so, the data needs to be collected
at the receiver end, statistics extracted, and the result
passed back to flent on the sending side.</p>

<p style="margin-left:11%; margin-top: 1em">To perform this
function, flent supports a control server which will listen
to XML-RPC requests, spawn an appropriate ITGRecv instance
and, after the test is done, parse its output and make it
available for flent to retrieve. This control server is
available as a Python file that by default is installed in
<i>/usr/share/doc/flent/misc</i>. It currently requires a
patched version of D-ITG v2.8.1. The patch is also included
in the same directory.</p>

<p style="margin-left:11%; margin-top: 1em">Note that the
D-ITG server is finicky and not designed with security in
mind. For this reason, the control server includes HMAC
authentication to only allow authenticated clients to run a
test against the server; however there is currently no
support for enforcement of this in e.g. firewall rules.
Please bear this in mind when running a publicly reachable
ITGRecv instance (with or without the control server).
Another security issue with the control server is that the
Python XML-RPC library by default is vulnerable to XML
entity expansion attacks. For this reason, it is highly
recommended to install the &rsquo;defusedxml&rsquo; library
(available at
<i>https://pypi.python.org/pypi/defusedxml/</i>) on the host
running the control server. The server will try to find the
library on startup and refuse to run if it is not available,
unless explicitly told otherwise.</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Run the
<i>rrul</i> test against <i>testserver.example.com:</i></p>

<p style="margin-left:22%; margin-top: 1em">flent rrul
testserver.example.com</p>

<p style="margin-left:11%; margin-top: 1em">This produces
no output, but saves the result in a datafile named after
the current date and time (in gzipped JSON format).</p>

<p style="margin-left:11%; margin-top: 1em">Show an
interactive plot of a previously run test, which stored the
data in <i>datafile.json.gz</i> (requires a working
matplotlib and a graphical display):</p>

<p style="margin-left:22%; margin-top: 1em">flent -f plot
datafile.json.gz</p>

<p style="margin-left:11%; margin-top: 1em">Combine
multiple data files into one CDF plot:</p>

<p style="margin-left:22%; margin-top: 1em">flent -p
icmp_cdf *.json.gz</p>

<h2>THE JSON DATA FORMAT
<a name="THE JSON DATA FORMAT"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The aggregated
test data is saved in a file called
<i>&lt;test_name&gt;-&lt;date&gt;.&lt;title&gt;.json.gz</i>
(the title part is omitted if no title is specified by the
<b>-t</b> parameter). This file contains the data points
generated during the test, as well as some metadata. The
top-level json object has three keys in it: <i>x_values</i>,
<i>results</i> and <i>metadata</i>.</p>


<p style="margin-left:11%; margin-top: 1em"><i>x_values</i>
is an array of the x values for the test data (typically the
time values for timeseries data).</p>

<p style="margin-left:11%; margin-top: 1em"><i>results</i>
is a json object containing the result data series. The keys
are the data series names; the value for each key is an
array of y values for that data series. The data array has
the same length as the <i>x_values</i> array, but there may
be missing data points (signified by null values).</p>


<p style="margin-left:11%; margin-top: 1em"><i>metadata</i>
is an object containing various data points about the test
run. The metadata values are read in as configuration
parameters when the data set is loaded in for further
processing. Not all tests use all the parameters, but they
are saved anyway.</p>

<p style="margin-left:11%; margin-top: 1em">Currently the
metadata values are:</p>

<p style="margin-left:22%; margin-top: 1em"><i>NAME</i>:
The test name.</p>

<p style="margin-left:22%; margin-top: 1em"><i>TITLE</i>:
Any extra title specified by the <b>-t</b> parameter when
the test was run.</p>

<p style="margin-left:22%; margin-top: 1em"><i>HOSTS</i>:
List of the server hostnames connected to during the
test.</p>


<p style="margin-left:22%; margin-top: 1em"><i>LOCAL_HOST</i>:
The hostname of the machine that ran the test.</p>

<p style="margin-left:22%; margin-top: 1em"><i>LENGTH</i>:
Test length in seconds, as specified by the <b>-l</b>
parameter.</p>


<p style="margin-left:22%; margin-top: 1em"><i>TOTAL_LENGTH</i>:
Actual data series length, after the test has added time to
the <i>LENGTH</i>.</p>


<p style="margin-left:22%; margin-top: 1em"><i>STEP_SIZE</i>:
Time step size granularity.</p>

<p style="margin-left:22%; margin-top: 1em"><i>TIME</i>:
ISO timestamp of the time the test was initiated.</p>

<p style="margin-left:22%; margin-top: 1em"><i>NOTE</i>:
Arbitrary text as entered with the <b>--note</b> switch when
the test was run.</p>


<p style="margin-left:22%; margin-top: 1em"><i>FLENT_VERSION</i>:
Version of flent that generated the data file.</p>


<p style="margin-left:22%; margin-top: 1em"><i>IP_VERSION</i>:
IP version used to run test (as specified by command line
parameters, or auto-detected from <i>getaddrinfo()</i> if
unspecified).</p>

<p style="margin-left:11%; margin-top: 1em">If the
<b>&minus;&minus;extended&minus;metadata</b> switch is
turned on, the following additional values are collected and
stored (to the extent they are available from the
platform):</p>


<p style="margin-left:22%; margin-top: 1em"><i>KERNEL_NAME</i>:
The kernel name as reported by <i>uname -s</i>.</p>


<p style="margin-left:22%; margin-top: 1em"><i>KERNEL_RELEASE</i>:
The kernel release as reported by <i>uname -r</i>.</p>


<p style="margin-left:22%; margin-top: 1em"><i>IP_ADDRS</i>:
IP addresses assigned to the machine running flent.</p>


<p style="margin-left:22%; margin-top: 1em"><i>GATEWAYS</i>:
IP addresses of all detected default gateways on the system,
and the interfaces they are reachable through. Only
available if the <i>netstat</i> binary is present on the
system.</p>


<p style="margin-left:22%; margin-top: 1em"><i>EGRESS_INFO</i>:
Egress interface, its qdisc, offload, driver and BQL
configuration, and (if applicable) the IP address of the
next-hop router used to reach the test target. The egress
interface and next-hop router requires that the <i>ip</i>
binary is present on Linux, but can be extracted from
<i>route</i> on BSD. Qdisc information requires the
<i>tc</i> binary to be present, and offload information
requires <i>ethtool</i>.</p>

<p style="margin-left:11%; margin-top: 1em">If the
<b>--remote-metadata</b> is used, the extended metadata info
is gathered for each of the hostnames specified. This is
gathered under the <i>REMOTE_METADATA</i> key in the
metadata object, keyed by the hostname values passed to
<b>--remote-metadata</b>. Additionally, the
<i>REMOTE_METADATA</i> object will contain an object called
<i>INGRESS_INFO</i> which is a duplicate of
<i>EGRESS_INFO</i>, but with the destination IP exchanged
for the source address of the host running flent. The
assumption here is that <b>--remote-metadata</b> is used to
capture metadata of a router known to be in the test path,
in which case <i>INGRESS_INFO</i> will contain information
about the reverse path from the router (which is ingress
from the point of view of the host running flent). If the
host being queried for remote metadata is off the path, the
contents of <i>INGRESS_INFO</i> will probably be the same as
that of <i>EGRESS_INFO</i>.</p>

<h2>SIGNALS
<a name="SIGNALS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Flent will
abort what it is currently doing on receiving a
<b>SIGINT</b> -- this includes killing all runners, cleaning
up temporary files and shutting down as gracefully as
possible. Runners are killed with <b>SIGTERM</b> in this
mode, and their output is discarded. If a batch run is in
progress, the current test will be interrupted in this way,
and the rest of the batch run is aborted. Previously
completed tests and their results are not aborted.
Post-commands marked as &rsquo;essential&rsquo; will be run
after the test is interrupted. Additionally, flent converts
<b>SIGTERM</b> into <b>SIGINT</b> internally and reacts
accordingly.</p>

<p style="margin-left:11%; margin-top: 1em">Upon receiving
a <b>SIGUSR1</b>, flent will try to gracefully abort the
test it is currently running, and parse the output of the
runners to the extent that any such output exists. That is,
each runner will be killed by a <b>SIGINT</b>, which will
cause a graceful shutdown for at least ping and netperf
(although netperf running in <i>TCP_MAERTS</i> mode will bug
out when interrupted like this, so end-of-tests statistics
will be missing). Flent will only react once to a
<b>SIGUSR1</b>, sending exactly one <b>SIGINT</b> to the
active runners, then wait for them to exit. This may take
several seconds in the case of netperf. If the runners for
some reason fail to exit, flent will be stuck and will need
to be killed with <b>SIGINT</b>. If running in batch mode,
<b>SIGUSR1</b> will only affect the currently running test;
subsequent tests will still be run.</p>

<h2>BUGS
<a name="BUGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Under some
conditions (such as severe bufferbloat), the UDP RTT
measurements done by netperf can experience packet loss to
the extent that the test aborts completely, which can cause
missing data points for some measurement series. The
--socket-timeout feature can alleviate this, but requires a
recent SVN version of netperf to work. Flent tries to detect
if netperf supports this option and enables it for the UDP
measurements if it does.</p>

<p style="margin-left:11%; margin-top: 1em">Probably many
other bugs. Please report any found to
<i>https://github.com/tohojo/flent/issues</i> and include
the output of <b>flent --version</b> in the report.</p>

<h2>AUTHORS
<a name="AUTHORS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Flent is
written and maintained by Toke
H&oslash;iland-J&oslash;rgensen, with contributions from
Dave Taht and others.</p>
<hr>
</body>
</html>
